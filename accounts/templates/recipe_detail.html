{% extends "base.html" %}
{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<div class="recipe-detail">

    <!-- Recipe Title -->
    <h2 class="recipe-title">{{ recipe.title }}</h2>
    <p class="recipe-author">By {{ recipe.user.username }}</p>

    <!-- IMAGE (optional) -->
    {% if recipe.image %}
        <img class="detail-img" src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
    {% endif %}

    <!-- VIDEO (optional) -->
    {% if recipe.video %}
        <video controls class="detail-video">
            <source src="{{ recipe.video.url }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    {% endif %}

    <!-- Recipe Info (Ingredients, Difficulty, Prep/Cook/Total Time) -->
    <div class="recipe-info">
        {% if recipe.ingredients %}
        <div class="info-section">
            <h3>Ingredients:</h3>
            <ul>
                {% for ingredient in recipe.ingredients.splitlines %}
                    <li>{{ ingredient }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="info-section">
            {% if recipe.difficulty %}<p><strong>Difficulty:</strong> {{ recipe.difficulty }}</p>{% endif %}
            {% if recipe.prep_time %}<p><strong>Prep Time:</strong> {{ recipe.prep_time }}</p>{% endif %}
            {% if recipe.cook_time %}<p><strong>Cook Time:</strong> {{ recipe.cook_time }}</p>{% endif %}
            {% if recipe.total_time %}<p><strong>Total Time:</strong> {{ recipe.total_time }}</p>{% endif %}
        </div>
    </div>

    <!-- Description -->
    <div class="recipe-description">
        <h3>Description:</h3>
        <p>{{ recipe.short_description }}</p>
    </div>

    <!-- Actions: Likes / Delete -->
    <div class="recipe-actions">
        {% if user != recipe.user %}
        <!-- Like Button -->
        <form method="POST" action="{% url 'like_recipe' recipe.id %}" class="like-form">
            {% csrf_token %}
            <button type="submit">
                {% if user in recipe.likes.all %}
                    ‚ù§Ô∏è Unlike
                {% else %}
                    ü§ç Like
                {% endif %}
                ({{ recipe.total_likes }})
            </button>
        </form>
        {% else %}
        <!-- Owner Delete Button -->
        <form method="POST" action="{% url 'delete_recipe' recipe.id %}" onsubmit="return confirm('Are you sure you want to delete this recipe?');">
            {% csrf_token %}
            <button type="submit" class="btn-delete">Delete Recipe</button>
        </form>
        {% endif %}
    </div>

    <!-- Comments Section -->
    {% if user != recipe.user %}
    <div class="comments-section">
        <h3>Comments</h3>
        <div class="comments">
            {% for comment in recipe.comments.all %}
                <p><strong>{{ comment.user.username }}:</strong> {{ comment.content }}</p>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}
        </div>

        <form method="POST">
            {% csrf_token %}
            <input type="text" name="content" placeholder="Add a comment..." required>
            <button type="submit">Post</button>
        </form>
    </div>
    {% endif %}

</div>
{% endblock %}
