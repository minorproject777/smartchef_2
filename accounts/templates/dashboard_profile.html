{% extends "base.html" %}
{% load static %}
{% block title %}{{ user.username }} Profile{% endblock %}

{% block content %}
<section class="profile-section">

    <div class="user-info">
        <!-- Profile picture with static fallback -->
        {% if profile.profile_image %}
            <img src="{{ profile.profile_image.url }}" alt="{{ profile.user.username }}" class="profile-pic">
        {% else %}
            <img src="{% static 'images/default.jpeg' %}" alt="Default Profile" class="profile-pic">
        {% endif %}



        <div class="details">
            <h2>{{user.username }}</h2>
            <p>{{ profile.full_name|default:user.username }}</p>
            <p>{{ user.email }}</p>
            <p>{{ profile.bio|default:"No bio yet." }}</p>

            <!-- Followers / Following -->
            <div class="follow-stats">
                <a href="{% url 'connections' user.username %}#followers">
                    <strong>{{ user.followers.count }}</strong> Followers
                </a> | 
                <a href="{% url 'connections' user.username %}#following">
                    <strong>{{ user.following.count }}</strong> Following
                </a>
            </div>

            <!-- Profile Actions -->
            <div class="profile-actions">
                {% if user == request.user %}
                    <!-- Own profile -->
                    <a href="{% url 'upload_recipe' %}" class="btn" title="Upload Recipe">
                        <i class="fas fa-upload"></i>
                    </a>
                    <a href="{% url 'edit_profile' %}" class="btn" title="Edit Profile">
                        <i class="fas fa-user-edit"></i>
                    </a>
                {% else %}
                    {% if is_following %}
                        <a href="{% url 'unfollow_user' user.id %}" class="btn">Unfollow</a>
                    {% else %}
                        <a href="{% url 'follow_user' user.id %}" class="btn">Follow</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recipes -->
    <div class="recipes-grid">
    {% for recipe in user_recipes %}
        <div class="recipe-wrapper">
            
            <a href="{% url 'recipe_detail' recipe.id %}" class="recipe-card">
                <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
                <h4>{{ recipe.title }}</h4>
            </a>

            {% if request.user == recipe.user %}
                <a href="{% url 'delete_recipe' recipe.id %}" 
                   onclick="return confirm('Delete this recipe?');"
                   class="btn-delete">
                   <i class="far fa-trash-alt"></i>
                </a>
            {% endif %}

        </div>
    {% endfor %}
</div>


</section>
{% endblock %}
